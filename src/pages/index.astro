---
import { getCollection } from 'astro:content';
const posts = await getCollection('blog');
const title = "Fotografický zápisník";

// Get unique categories from all posts
const categories = Array.from(new Set(posts.flatMap(post => post.data.categories || []))).sort();
---

<html lang="cs">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>{title}</title>
		<style>
			body { 
				font-family: 'Inter', sans-serif; 
				background: #000; /* Černé pozadí */
				color: #fff;       /* Bílý text */
				margin: 0; 
				padding: 0; 
			}
			.container { max-width: 1100px; margin: 0 auto; padding: 2rem; }
			header { border-bottom: 1px solid #222; margin-bottom: 3rem; padding-bottom: 1rem; } /* Tmavší linka */
			h1 { font-weight: 300; letter-spacing: -0.02em; text-transform: uppercase; font-size: 1.5rem; color: #fff; }
			
			.category-filters { 
				display: flex; 
				gap: 0.5rem; 
				flex-wrap: wrap; 
				margin-top: 1rem; 
			}
			
			.filter-btn { 
				background: #111; 
				border: 1px solid #333; 
				color: #999; 
				padding: 0.5rem 1rem; 
				border-radius: 4px; 
				cursor: pointer; 
				font-size: 0.9rem; 
				transition: all 0.2s ease; 
			}
			
			.filter-btn:hover { 
				border-color: #555; 
				color: #ccc; 
			}
			
			.filter-btn.active { 
				background: #fff; 
				color: #000; 
				border-color: #fff; 
			}
			
			.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
			.card { text-decoration: none; color: inherit; }
			
			/* Úprava karet pro tmavý režim */
			.image-placeholder { aspect-ratio: 3/2; background: #111; width: 100%; display: block; overflow: hidden; }
			.card h2 { margin: 1rem 0 0.5rem 0; font-size: 1.1rem; font-weight: 500; color: #fff; }
			.card p { color: #666; font-size: 0.9rem; } /* Šedý text pro datum */
			
			.category-badge {
				background: #333;
				color: #aaa;
				padding: 0.25rem 0.75rem;
				border-radius: 3px;
				font-size: 0.85rem;
			}

			/* Úprava menu (pokud jsi ho tam nechal) */
			.nav-item { color: #666; }
			.nav-item:hover { color: #fff; }
			.dropdown { background: #111; border: 1px solid #222; }
			.dropdown-item { color: #ccc; }
			.dropdown-item:hover { background: #222; color: #fff; }
		</style>
	</head>
	<body>
		<div class="container">
			<header>
				<h1>{title}</h1>
				
				{categories.length > 0 && (
					<div class="category-filters">
						<button class="filter-btn active" data-category="all">Všechny</button>
						{categories.map(category => (
							<button class="filter-btn" data-category={category}>
								{category}
							</button>
						))}
					</div>
				)}
			</header>
			
			<main class="grid" id="posts-grid">
				{posts.map(post => (
					<a href={`/blog/${post.slug}`} class="card" data-categories={JSON.stringify(post.data.categories || [])}>
						<div class="image-placeholder">
							<img src={post.data.coverImage} alt={post.data.title} style="width:100%; height:100%; object-fit:cover;" />
						</div>
						<h2>{post.data.title}</h2>
						<div style="display: flex; flex-direction: column; gap: 0.5rem;">
							<p>{post.data.date.toLocaleDateString('cs-CZ')} • {post.data.lang.toUpperCase()}</p>
							{post.data.categories && post.data.categories.length > 0 && (
								<div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
									{post.data.categories.map(cat => (
										<span class="category-badge">{cat}</span>
									))}
								</div>
							)}
						</div>
					</a>
				))}
			</main>
		</div>

		<script>
			document.querySelectorAll('.filter-btn').forEach(btn => {
				btn.addEventListener('click', () => {
					document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
					btn.classList.add('active');
					
					const selectedCategory = btn.dataset.category;
					document.querySelectorAll('.card').forEach(card => {
						const categories = JSON.parse(card.dataset.categories || '[]');
						if (selectedCategory === 'all' || categories.includes(selectedCategory)) {
							card.style.display = '';
						} else {
							card.style.display = 'none';
						}
					});
				});
			});
		</script>						
	</body>
</html>